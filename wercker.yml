box: debian

command-timeout: 60

build:
    steps:
        - install-packages:
            packages: git build-essential flex bison zlib1g-dev qt4-dev-tools libqt4-dev gnuplot libreadline-dev libncurses-dev libxt-dev libopenmpi-dev openmpi-bin rpm wget
        - script:
            name: third-party
            code: |
                git clone --branch v3.2 git://git.code.sf.net/p/openfoam-extend/foam-extend-3.1 foam-extend-3.2
                export PARAVIEW_SYSTEM=1
                export CUDA_IGNORE=1
                export SWAK4FOAM_SYSTEM=1
                export WM_MPLIB=SYSTEMOPENMPI
                export OPENMPI_DIR=/usr
                export OPENMPI_BIN_DIR=$OPENMPI_DIR/bin
                export FOAM_INST_DIR=`pwd`

                sed -i s/"CC          = g++ -m64"/"CC          = mpicxx -m64"/g foam-extend-3.2/wmake/rules/linux64Gcc/c++

                cd foam-extend-3.2
                source etc/bashrc

                # wmake is required for subsequent targets
                ( cd wmake/src && make )

                # build ThirdParty sources
                ( cd $WM_THIRD_PARTY_DIR && ./AllMake )
        - script:
            name: foam-extend
            code: |
                export PARAVIEW_SYSTEM=1
                export CUDA_IGNORE=1
                export SWAK4FOAM_SYSTEM=1
                export WM_MPLIB=SYSTEMOPENMPI
                export OPENMPI_DIR=/usr
                export OPENMPI_BIN_DIR=$OPENMPI_DIR/bin
                export FOAM_INST_DIR=`pwd`

                cd foam-extend-3.2
                source etc/bashrc

                # build OpenFOAM libraries and applications
                src/Allwmake
